import { getPreferenceValues } from \"@raycast/api\";\n\ninterface Preferences {\n  assistant_base_url: string;\n  api_timeout_ms?: string;\n}\n\nconst getBaseUrl = (): string => {\n  const prefs = getPreferenceValues<Preferences>();\n  const url = prefs.assistant_base_url || process.env.ASSISTANT_BASE_URL;\n  \n  if (!url) {\n    throw new Error(\"Assistant backend URL not configured. Please set it in preferences.\");\n  }\n  \n  return url.replace(/\/$/, \"\"); // Remove trailing slash\n};\n\nconst getTimeout = (): number => {\n  const prefs = getPreferenceValues<Preferences>();\n  const timeout = prefs.api_timeout_ms || \"30000\";\n  return parseInt(timeout, 10);\n};\n\ninterface SweepBillsParams {\n  jurisdictions: string[];\n  since?: string;\n}\n\ninterface SweepBillsResult {\n  items: Array<{\n    title: string;\n    jurisdiction: string;\n    status: string;\n    last_action: string;\n    url?: string;\n    summary?: string;\n  }>;\n}\n\nexport async function sweepBills(\n  params: SweepBillsParams\n): Promise<SweepBillsResult> {\n  const baseUrl = getBaseUrl();\n  const timeout = getTimeout();\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n  try {\n    const response = await fetch(`${baseUrl}/sweep_bills`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(params),\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(\n        `API error: ${response.status} ${response.statusText} - ${error}`\n      );\n    }\n\n    const data = (await response.json()) as SweepBillsResult;\n    return data;\n  } catch (error) {\n    if (error instanceof TypeError && error.message.includes(\"fetch\")) {\n      throw new Error(\"Network error. Check your connection and backend URL.\");\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\ninterface GenerateSectionParams {\n  section: string;\n  prompt: string;\n}\n\ninterface GenerateSectionResult {\n  content: string;\n  metadata?: {\n    tokens_used?: number;\n    model?: string;\n    timestamp?: string;\n  };\n}\n\nexport async function generateSection(\n  params: GenerateSectionParams\n): Promise<GenerateSectionResult> {\n  const baseUrl = getBaseUrl();\n  const timeout = getTimeout();\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n  try {\n    const response = await fetch(`${baseUrl}/generate_section`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(params),\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(\n        `API error: ${response.status} ${response.statusText} - ${error}`\n      );\n    }\n\n    const data = (await response.json()) as GenerateSectionResult;\n    return data;\n  } catch (error) {\n    if (error instanceof TypeError && error.message.includes(\"fetch\")) {\n      throw new Error(\"Network error. Check your connection and backend URL.\");\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\ninterface AddSourceParams {\n  title: string;\n  url: string;\n  notes?: string;\n}\n\ninterface AddSourceResult {\n  success: boolean;\n  id?: string;\n  message?: string;\n}\n\nexport async function addSource(\n  params: AddSourceParams\n): Promise<AddSourceResult> {\n  const baseUrl = getBaseUrl();\n  const timeout = getTimeout();\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n  try {\n    const response = await fetch(`${baseUrl}/add_source`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(params),\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(\n        `API error: ${response.status} ${response.statusText} - ${error}`\n      );\n    }\n\n    const data = (await response.json()) as AddSourceResult;\n    return data;\n  } catch (error) {\n    if (error instanceof TypeError && error.message.includes(\"fetch\")) {\n      throw new Error(\"Network error. Check your connection and backend URL.\");\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n", "_tool_input_summary": "Create src/utils/api.ts with API client functions for sweepBills, generateSection, and addSource with error handling", "_requires_user_approval": true}